version: "3.8"

volumes:
  eco_db:

services:
# マイクラ本体よ
  mc:
    image: itzg/minecraft-server
    volumes:
      - ./data:/data
    ports: 
      - 25565:25565
    environment:
      EULA: "TRUE"
      TYPE: "PAPER"
      VERSION: "1.19.2"
      MEMORY: "14G"
      TZ: "Asia/Tokyo"
    tty: true
    stdin_open: true
    depends_on: 
      - db
    restart: unless-stopped
# データベースよ
  db:
    image: mariadb
    restart: always
    ports: 
      - 3306:3306
    volumes:
      - eco_db:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - MYSQL_DATABASE=eco
      - MYSQL_USER=eco
    command: >
      --character-set-server=utf8
      --collation-server=utf8_general_ci
      --default-time-zone='Asia/Tokyo'
# Minecraftのプラグイン何入ってるのよって言われたときにググれするためのTextを生成するよ
  plugins_list_builder:
    image: python:3.10.5-alpine3.16
    volumes:
      - ./data/plugins:/usr/src/hoge/data
      - ./py:/usr/src/hoge
    working_dir: /usr/src/hoge
    command: python3 main.py
# DBのデータをやり取りするためのAPIだよ
  api:
    build: ./api
    restart: always
    environment:
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - API_PASSWORD=${API_PASSWORD}
      - MYSQL_DATABASE=eco
      - MYSQL_USER=eco
    volumes:
      - ./api/app:/go/src/app
      - ./data/plugins/DiscordSRV/linkedaccounts.json:/go/src/app/data/linkedaccounts.json
    command: go run main.go
# リバースプロキシだよ
  reverse-proxy:
    image: nginx
    restart: always
    volumes:
      - ./rev/nginx.conf:/etc/nginx/nginx.conf
    ports:
      - 80:80
# しなもんBOTだよ
  # cinnamon_bot:
  #   build: ./CinnamonBot
  #   restart: always
  #   volumes:
  #     - ./CinnamonBot/bot:/usr/src/bot
  #   environment:
  #     - TOKEN=${TOKEN}
  #     - GUILD=${GUILD}
  #   command: python3 main.py